{% extends "customer/base.html" %}
{% load humanize %}

{% block title %}Chi tiết đơn{% endblock %}

{% block content %}
<h3 class="mb-3">Chi tiết đơn #{{ donhang.ma_don_hang }}</h3>

<div class="card">
  <div class="card-body">
    {% for it in donhang.chi_tiet %}
    <div class="d-flex align-items-center gap-3 mb-3">
      {% if it.hinh_anh %}
      <img src="{{ MEDIA_URL }}{{ it.hinh_anh }}" style="width:96px;height:96px;object-fit:cover" class="rounded">
      {% endif %}
      <div>
        <div class="fw-semibold">{{ it.ten_san_pham }}</div>
        <div class="text-muted small">SL: {{ it.so_luong }} × {{ it.don_gia|intcomma }}</div>
      </div>
      <div class="ms-auto fw-bold">{{ it.thanh_tien|intcomma }} đ</div>
    </div>
    {% endfor %}

    <hr>
    <div class="d-flex justify-content-between">
      <div>
        Trạng thái:
        <span class="badge
          {% if donhang.trang_thai == 'cho_xu_ly' %} text-bg-secondary
          {% elif donhang.trang_thai == 'da_xac_nhan' %} text-bg-info
          {% elif donhang.trang_thai == 'dang_giao' %} text-bg-warning
          {% elif donhang.trang_thai == 'hoan_thanh' %} text-bg-success
          {% elif donhang.trang_thai == 'da_huy' or donhang.trang_thai == 'huy' %} text-bg-danger
          {% else %} text-bg-light{% endif %}">
          {{ donhang.trang_thai|title }}
        </span>
        <div class="text-muted small">Ngày tạo: {{ donhang.ngay_tao|date:"d/m/Y H:i" }}</div>
      </div>
      <div class="fs-5 fw-bold text-success">Tổng: {{ donhang.tong_tien|intcomma }} đ</div>
    </div>

    <div class="mt-3">
      <a href="{% url 'shop:orders_index' %}" class="btn btn-outline-secondary">Về danh sách</a>
      {% if donhang.trang_thai == 'cho_xu_ly' %}
      <form class="d-inline" method="post" action="{% url 'shop:cancel_order' %}">
        {% csrf_token %}
        <input type="hidden" name="id" value="{{ donhang.id }}">
        <button class="btn btn-outline-danger" onclick="return confirm('Hủy đơn này?')">Hủy đơn</button>
      </form>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
