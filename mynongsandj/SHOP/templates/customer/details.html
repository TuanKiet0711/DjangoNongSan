{% extends "customer/base.html" %}
{% load humanize %}

{% block title %}Chi tiết đơn {{ donhang.ma_don_hang }}{% endblock %}

{% block content %}
<h2 class="mb-3">Đơn: {{ donhang.ma_don_hang }}</h2>

<p><b>Trạng thái:</b> {{ donhang.trang_thai }}</p>

{% if donhang.phuong_thuc_thanh_toan %}
<p><b>Phương thức thanh toán:</b> 
  {% if donhang.phuong_thuc_thanh_toan == "BANK" %}
    Chuyển khoản
  {% else %}
    Thanh toán khi nhận
  {% endif %}
</p>
{% endif %}

{% if donhang.trang_thai|lower == "pending" %}
<form method="post" action="{% url 'shop:cancel_order' %}" class="mb-3 d-inline" 
      onsubmit="return confirm('Bạn chắc muốn hủy đơn này?')">
  {% csrf_token %}
  <input type="hidden" name="id" value="{{ donhang.id }}">
  <button type="submit" class="btn btn-danger">Hủy đơn</button>
</form>
{% endif %}

<table class="table table-bordered align-middle">
  <thead>
    <tr>
      <th>Sản phẩm</th>
      <th class="text-end">Đơn giá</th>
      <th class="text-center">SL</th>
      <th class="text-end">Thành tiền</th>
    </tr>
  </thead>
  <tbody>
    {% for ct in donhang.chi_tiet %}
    <tr>
      <td>{{ ct.ten_san_pham }}</td>
      <td class="text-end">{{ ct.don_gia|intcomma }} đ</td>
      <td class="text-center">{{ ct.so_luong }}</td>
      <td class="text-end">{{ ct.thanh_tien|intcomma }} đ</td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th colspan="3" class="text-end">Tổng cộng</th>
      <th class="text-end">{{ donhang.tong_tien|intcomma }} đ</th>
    </tr>
  </tfoot>
</table>

<a href="{% url 'shop:orders_index' %}" class="btn btn-outline-secondary">Quay lại danh sách</a>
{% endblock %}
