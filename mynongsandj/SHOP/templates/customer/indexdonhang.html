{% extends 'customer/base.html' %}
{% block content %}
<h2 class="mb-3">Đơn hàng của tôi</h2>
<div id="orders"></div>

<script>
async function loadOrders() {
  const res = await fetch('/api/orders/', {credentials: 'same-origin'});
  if (res.status === 401) return location.href = "{% url 'shop:auth_login_page' %}";
  const data = await res.json();
  const list = data.items || [];
  const wrap = document.getElementById('orders');
  if (!list.length) {
    wrap.innerHTML = '<div class="alert alert-info">Bạn chưa có đơn hàng nào.</div>';
    return;
  }
  wrap.innerHTML = `
    <table class="table table-striped align-middle">
      <thead><tr>
        <th>Mã đơn</th><th class="text-end">Tổng tiền</th>
        <th>Trạng thái</th><th>Ngày tạo</th><th></th>
      </tr></thead>
      <tbody>
        ${list.map(o => `
          <tr>
            <td>${o.id}</td>
            <td class="text-end">${o.tongTien.toLocaleString()} đ</td>
            <td>${o.trangThai}</td>
            <td>${new Date(o.ngayTao).toLocaleString()}</td>
            <td><a href="/don-hang/${o.id}/" class="btn btn-sm btn-primary">Chi tiết</a></td>
          </tr>
        `).join('')}
      </tbody>
    </table>`;
}
loadOrders();
</script>
{% endblock %}
