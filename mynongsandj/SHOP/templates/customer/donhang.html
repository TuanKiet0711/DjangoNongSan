{% extends "customer/base.html" %}
{% load humanize %}

{% block title %}Đơn hàng của tôi{% endblock %}

{% block content %}
<h2 class="mb-3">Đơn hàng của tôi</h2>

{% if not donhangs %}
  <div class="alert alert-info">Bạn chưa có đơn nào.</div>
{% else %}
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Mã đơn</th>
        <th class="text-end">Tổng tiền</th>
        <th>Trạng thái</th>
        <th style="width:220px"></th>
      </tr>
    </thead>
    <tbody>
      {% for d in donhangs %}
      <tr>
        <td>{{ d.ma_don_hang }}</td>
        <td class="text-end">{{ d.tong_tien|intcomma }} đ</td>
        <td>{{ d.trang_thai }}</td>
        <td>
          <a href="{% url 'shop:order_details' d.id %}" class="btn btn-sm btn-outline-primary me-2">Chi tiết</a>

          {% if d.trang_thai|lower == "pending" %}
          <form method="post" action="{% url 'shop:cancel_order' %}" class="d-inline"
                onsubmit="return confirm:'Hủy đơn {{ d.ma_don_hang }} ?'">
            {% csrf_token %}
            <input type="hidden" name="id" value="{{ d.id }}">
            <button type="submit" class="btn btn-sm btn-danger">Hủy</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
{% endblock %}
