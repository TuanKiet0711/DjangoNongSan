{% extends "customer/base.html" %}
{% load humanize %}

{% block title %}Đơn hàng của tôi{% endblock %}

{% block content %}
<h3 class="mb-3">Đơn hàng của tôi</h3>

{% if orders %}
<div class="table-responsive">
  <table class="table align-middle">
    <thead class="table-light">
      <tr>
        <th>Mã</th>
        <th>Sản phẩm</th>
        <th class="text-end">SL</th>
        <th class="text-end">Đơn giá</th>
        <th class="text-end">Tổng</th>
        <th>Trạng thái</th>
        <th>Ngày</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% for o in orders %}
      <tr>
        <td class="text-muted small">{{ o.id|slice:":8" }}</td>
        <td>
          <div class="d-flex align-items-center gap-2">
            {% if o.san_pham.hinh %}
              <img src="{{ MEDIA_URL }}{{ o.san_pham.hinh }}" class="rounded" style="width:44px;height:44px;object-fit:cover">
            {% endif %}
            <div>{{ o.san_pham.ten }}</div>
          </div>
        </td>
        <td class="text-end">{{ o.so_luong }}</td>
        <td class="text-end">{{ o.don_gia|intcomma }}</td>
        <td class="text-end fw-semibold">{{ o.tong_tien|intcomma }}</td>
        <td>
          {% with s=o.trang_thai %}
            <span class="badge
              {% if s == 'cho_xu_ly' %} text-bg-secondary
              {% elif s == 'da_xac_nhan' %} text-bg-info
              {% elif s == 'dang_giao' %} text-bg-warning
              {% elif s == 'hoan_thanh' %} text-bg-success
              {% elif s == 'da_huy' %} text-bg-danger
              {% else %} text-bg-light{% endif %}">
              {{ s|title }}
            </span>
          {% endwith %}
        </td>
        <td>{{ o.ngay_tao|date:"d/m/Y H:i" }}</td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-primary" href="{% url 'shop:order_details' o.id %}">Chi tiết</a>
          {% if o.trang_thai == 'cho_xu_ly' %}
          <form class="d-inline" method="post" action="{% url 'shop:cancel_order' %}">
            {% csrf_token %}
            <input type="hidden" name="order_id" value="{{ o.id }}">
            <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Hủy đơn này?')">Hủy</button>
          </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="alert alert-info">Bạn chưa có đơn hàng nào.</div>
<a href="{% url 'shop:sanpham_list' %}" class="btn btn-success">Mua sắm ngay</a>
{% endif %}
{% endblock %}
